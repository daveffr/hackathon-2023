<!DOCTYPE html>
<html lang="en">
    <head>
        
    </head>
    <body>
        <h1>Language Sharing</h1>
        <h2>Log In</h2>
        
        <label for="username">Username:</label>
        <input type="text" name="username" id="username">
        <br>
        <label for="password">Password:</label>
        <input type="password" name="password" id="password">
        <br>
        <input type="submit" value="Login" id = "login">
        
        <h2>Create Account</h2>
        
        <label for="new_username">Username:</label>
        <input type="text" name="new_username" id="new_username">
        <br>
        <label for="new_password">Password:</label>
        <input type="password" name="new_password" id="new_password">
        <br>
        <input type="submit" value="Create Account" id = "createAccount">

        <script>
            document.getElementById("login").addEventListener("click", login, false);

            function login(event) {
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
            
                const data = { 'username': username, 'password': password };
                fetch("login.php", {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: { 'content-type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    if(data.success) {
                        document.getElementById("login").removeEventListener('click', login, false);
                        document.getElementById("createAccount").removeEventListener('click', create_account, false);
                        fetch("userinfo.php", {
                            method: 'POST',
                            body: JSON.stringify(data),
                            headers: { 'content-type': 'application/json' }
                        }).then(response => response.json())
                        .then(data => {
                            document.body.innerHTML = 'Logged in as ' + data.username;
                            const form = document.createElement('form');
                            form.setAttribute('id', 'myForm');
                            document.body.appendChild(form);
                    
                            // Create a form title
                            const formTitle = document.createElement('h2');
                            formTitle.textContent = 'Generic Form';
                            form.appendChild(formTitle);
                    
                            // Create an input field for a text box
                            const inputText = document.createElement('input');
                            inputText.setAttribute('type', 'text');
                            inputText.setAttribute('name', 'text-input');
                            inputText.setAttribute('placeholder', 'Enter text');
                            form.appendChild(inputText);
                    
                            // Create a submit button
                            const submitButton = document.createElement('input');
                            submitButton.setAttribute('type', 'submit');
                            submitButton.setAttribute('value', 'Submit');
                            form.appendChild(submitButton);
                    
                            // Event listener for form submission
                            form.addEventListener('submit', function (e) {
                                e.preventDefault();
                                const formData = new FormData(form);
                                alert('Submitted data: ' + formData.get('text-input'));
                            });
                        });
                        
                    }
                })
                .catch(err => console.error(err));
            }
            
            document.getElementById("createAccount").addEventListener("click", create_account, false);

            function create_account(event) {
                const username = document.getElementById("new_username").value;
                const password = document.getElementById("new_password").value;
            
                const data = { 'username': username, 'password': password };
                fetch("create_account.php", {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: { 'content-type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => console.log(data.success ? "You've created a new account!" : `You did not create a new account! ${data.message}`))
                .catch(err => console.error(err));
            }

        </script>
    </body>
</html>